(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ac95b942"],{"4a12":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAdd}},[e._v(e._s(e.buttonName))]),a("el-dialog",{attrs:{title:"上传文件",visible:e.open,width:"700px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("span",[e._v("文件名：")]),a("el-input",{attrs:{placeholder:"文件名"},model:{value:e.fileName,callback:function(t){e.fileName=t},expression:"fileName"}})],1),a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.uploadUrl,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-success":e.onUploadSuccess,"on-change":e.onChangeFile,"file-list":e.fileList,"auto-upload":!1,headers:e.headers,accept:e.fileAccept,limit:1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:e.submitUpload}},[e._v("上传到服务器")]),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"danger"},on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)},o=[],s=(a("b0c0"),a("1bb3")),i={name:"uploadFile",props:{fileAccept:{type:String,default:"*.*"},buttonName:{type:String,default:"上传"}},data:function(){return{loading:!0,open:!1,fileList:[],uploadedFileList:[],uploadUrl:"/file/upload",headers:{Authorization:"Bearer "+Object(s["a"])()},fileName:"",statusOptions:[{value:!1,label:"文件"},{value:!0,label:"目录"}]}},created:function(){},methods:{cancel:function(){this.open=!1},handleAdd:function(){this.uploadedFileList=[],this.open=!0},submitUpload:function(){this.$refs.upload.submit()},handleRemove:function(e,t){console.log(e,t)},handlePreview:function(e){console.log(e)},onUploadSuccess:function(e){200===e.code&&(e.data.fileName=this.fileName,this.uploadedFileList.push(e.data.filePath),this.$emit("onUploadFile",this.uploadedFileList),this.$emit("onUploadFileDetail",e),this.open=!1)},onChangeFile:function(e,t){this.fileName||(this.fileName=e.name)}}},l=i,c=a("2877"),r=Object(c["a"])(l,n,o,!1,null,null,null);t["a"]=r.exports},5831:function(e,t,a){"use strict";var n=a("53ca"),o=(a("fb6a"),a("e9c4"),a("d3b7"),a("caad"),a("2532"),a("bc3a")),s=a.n(o),i=a("5c96"),l=a("3048"),c=a("1bb3"),r=a("e6f3"),u=a("9ee1"),d=a("1908"),p={show:!1};s.a.defaults.headers["Content-Type"]="application/json;charset=utf-8";var f=s.a.create({baseURL:"",timeout:1e4});f.interceptors.request.use((function(e){var t=!1===(e.headers||{}).isToken,a=!1===(e.headers||{}).repeatSubmit;if(Object(c["a"])()&&!t&&(e.headers["Authorization"]="Bearer "+Object(c["a"])()),"get"===e.method&&e.params){var o=e.url+"?"+Object(u["k"])(e.params);o=o.slice(0,-1),e.params={},e.url=o}if(!a&&("post"===e.method||"put"===e.method)){var s={url:e.url,data:"object"===Object(n["a"])(e.data)?JSON.stringify(e.data):e.data,time:(new Date).getTime()},i=d["a"].session.getJSON("sessionObj");if(void 0===i||null===i||""===i)d["a"].session.setJSON("sessionObj",s);else{var l=i.url,r=i.data,p=i.time,f=1e3;if(r===s.data&&s.time-p<f&&l===s.url){var m="数据正在处理，请勿重复提交";return console.warn("[".concat(l,"]: ")+m),Promise.reject(new Error(m))}d["a"].session.setJSON("sessionObj",s)}}return e}),(function(e){console.log(e),Promise.reject(e)})),f.interceptors.response.use((function(e){var t=e.data.code||200,a=r["a"][t]||e.data.msg||r["a"]["default"];return"blob"===e.request.responseType||"arraybuffer"===e.request.responseType?e.data:401===t?(p.show||(p.show=!0,i["MessageBox"].confirm("登录状态已过期，您可以继续留在该页面，或者重新登录","系统提示",{confirmButtonText:"重新登录",cancelButtonText:"取消",type:"warning"}).then((function(){p.show=!1,l["a"].dispatch("LogOut").then((function(){location.href="/index"}))})).catch((function(){p.show=!1}))),Promise.reject("无效的会话，或者会话已过期，请重新登录。")):500===t?(Object(i["Message"])({message:a,type:"error"}),Promise.reject(new Error(a))):200!==t?(i["Notification"].error({title:a}),Promise.reject("error")):e.data}),(function(e){console.log("err"+e);var t={},a=e.message;return"Network Error"==a?(a="后端接口连接异常",t.code=500):a.includes("timeout")?(a="系统接口请求超时",t.code=500):a.includes("Request failed with status code")&&(e.response&&e.response.data&&!e.response.data.msg?(a=e.response.data.msg,t.code=500):(a="系统接口"+a.substr(a.length-3)+"异常",t.code=e.response.status)),t.message=a,t})),t["a"]=f},b86f:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",[a("span",{staticStyle:{color:"#ff0000"}},[e._v("请选择正确的升级包导入，升级成功后会重启系统，将短暂中断业务")]),a("upload-file",{attrs:{buttonName:e.sysButtonName,fileAccept:e.fileAcceptSys},on:{onUploadFile:e.onUploadSys}})],1),a("div",{staticStyle:{"margin-top":"10px"}},[a("span",{staticStyle:{color:"#ff0000"}},[e._v("请选择正确的升级包导入，升级成功后会重启应用，将短暂中断业务")]),a("upload-file",{attrs:{buttonName:e.apkButtonName,fileAccept:e.fileAcceptApk},on:{onUploadFile:e.onUploadApk}})],1)])},o=[],s=a("4a12"),i=a("70f0"),l=a("5831");function c(e,t){var a={commandId:"maintain-req-upgrade",data:{filePath:e,upgradeType:t}};return Object(i["a"])({url:"/maintain/custom",method:"post",data:a})}function r(){var e={commandId:"maintain-req-upgrade-status"};return Object(l["a"])({url:"/maintain/custom",method:"post",data:e})}var u={preStatus:null,checkTimeInterval:2e3,checkTimer:null,statusCallback:null,init:function(){u.stopCheck()},startCheck:function(e){u.statusCallback=e,null==u.checkTimer&&(u.checkTimer=setInterval((function(){r().then((function(e){if(200===e.code){var t=e.data.status;u.preStatus!=t&&(u.preStatus=t,u.statusCallback&&u.statusCallback(e.data.status,e.data.reason))}else 401==e.code&&u.statusCallback&&u.statusCallback(401,null)})).catch((function(e){console.log(e)}))}),u.checkTimeInterval))},stopCheck:function(){null!=u.checkTimer&&(clearInterval(u.checkTimer),u.checkTimer=null),u.preStatus=null}},d=u,p=a("1bb3"),f=1,m=2,h=3,b=4,v=6,g=0,k=1,y={name:"upgrade",components:{uploadFile:s["a"]},data:function(){return{form:{password:""},apkButtonName:"导入应用",fileAcceptApk:"*.apk",sysButtonName:"导入系统",fileAcceptSys:"*.zip"}},created:function(){},methods:{onUploadApk:function(e){var t=this;c(e[0],g).then((function(e){200==e.code&&(t.$modal.loading("升级中，请稍候！"),d.init(),d.startCheck(t.onRestartSuccess))}))},onUploadSys:function(e){var t=this;c(e[0],k).then((function(e){200==e.code&&(t.$modal.loading("升级中，请稍候！"),d.init(),d.startCheck(t.onRestartSuccess))}))},onRestartSuccess:function(e,t){if(401===e)this.$modal.closeLoading(),Object(p["b"])(),location.href="/index";else if(e==this.upgrade_status_failed)this.$modal.closeLoading(),t&&this.msgError(t);else{var a="升级异常";e==f?a="正在拷贝文件":e==m?a="正在解压文件":e==h?a="正在升级":e==b?a="升级完成":e==v&&(a="正在进行文件校验"),this.$modal.loading(a)}}}},S=y,w=a("2877"),N=Object(w["a"])(S,n,o,!1,null,null,null);t["default"]=N.exports}}]);
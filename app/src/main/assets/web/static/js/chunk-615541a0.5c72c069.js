(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-615541a0"],{"104b":function(e,t,a){"use strict";a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861");var i=a("ddfe"),n=a("21a6"),l={downloadInterval:2e3,downloadTimer:null,filePath:[],saveFileName:null,mainType:null,subType:null,isZip:!0,callback:null,packageCallback:null,autoDownload:!0,downloadFile:function(){Object(i["a"])(l.filePath,l.isZip,l.mainType,l.subType).then((function(e){var t="application/zip";"media"===l.mainType&&"audio"===l.subType?t="audio/mp3":"media"===l.mainType&&"video"===l.subType?t="audio/mp4":"media"===l.mainType&&"image"===l.subType&&(t="image/png");var a=new Blob([e],{type:t});l.saveFileName&&Object(n["saveAs"])(a,l.saveFileName),l.callback&&l.callback(l.saveFileName?l.saveFileName:window.URL.createObjectURL(a))}))},doPackageFile:function(){var e=this;Object(i["d"])(l.filePath,l.isZip,l.mainType,l.subType).then((function(t){t.code&&(200!=t.code?e.msgError(t.msg):(l.filePath=[],l.filePath.push(t.data.filePath),t.data.ready?(l.packageCallback&&l.packageCallback(t.data),l.autoDownload&&l.downloadFile()):l.startDownloadTimer()))}))},startDownload:function(e,t,a,i,n){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];l.filePath=e,l.isZip=o,l.mainType=t,l.subType=a,l.saveFileName=i,l.callback=n,l.packageCallback=s,l.autoDownload=r,l.doPackageFile()},startDownloadTimer:function(){null==l.downloadTimer&&setTimeout((function(){l.doPackageFile()}),l.downloadInterval)}};t["a"]=l},"4a12":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAdd}},[e._v(e._s(e.buttonName))]),a("el-dialog",{attrs:{title:"上传文件",visible:e.open,width:"700px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("span",[e._v("文件名：")]),a("el-input",{attrs:{placeholder:"文件名"},model:{value:e.fileName,callback:function(t){e.fileName=t},expression:"fileName"}})],1),a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.uploadUrl,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-success":e.onUploadSuccess,"on-change":e.onChangeFile,"file-list":e.fileList,"auto-upload":!1,headers:e.headers,accept:e.fileAccept,limit:1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:e.submitUpload}},[e._v("上传到服务器")]),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"danger"},on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)},n=[],l=(a("b0c0"),a("1bb3")),o={name:"uploadFile",props:{fileAccept:{type:String,default:"*.*"},buttonName:{type:String,default:"上传"}},data:function(){return{loading:!0,open:!1,fileList:[],uploadedFileList:[],uploadUrl:"/file/upload",headers:{Authorization:"Bearer "+Object(l["a"])()},fileName:"",statusOptions:[{value:!1,label:"文件"},{value:!0,label:"目录"}]}},created:function(){},methods:{cancel:function(){this.open=!1},handleAdd:function(){this.uploadedFileList=[],this.open=!0},submitUpload:function(){this.$refs.upload.submit()},handleRemove:function(e,t){console.log(e,t)},handlePreview:function(e){console.log(e)},onUploadSuccess:function(e){200===e.code&&(e.data.fileName=this.fileName,this.uploadedFileList.push(e.data.filePath),this.$emit("onUploadFile",this.uploadedFileList),this.$emit("onUploadFileDetail",e),this.open=!1)},onChangeFile:function(e,t){this.fileName||(this.fileName=e.name)}}},s=o,r=a("2877"),d=Object(r["a"])(s,i,n,!1,null,null,null);t["a"]=d.exports},"7a09":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-row",{staticClass:"mb8",attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[a("upload-file",{on:{onUploadFile:e.onUploadFile}})],1),a("el-col",{attrs:{span:1.5}},[e.queryParams.dir.indexOf("/")>0?a("el-button",{attrs:{type:"success",icon:"el-icon-replay",size:"mini"},on:{click:e.backFolder}},[e._v("返回上级目录")]):e._e()],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tables",attrs:{data:e.list},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),a("el-table-column",{attrs:{label:"名称",align:"left",prop:"dir"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.dir?a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-folder"},on:{click:function(a){return e.nextFolder(t.row)}}},[e._v(e._s(t.row.name))]):e._e(),t.row.dir?e._e():a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-file-text"}},[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{label:"保存目录",align:"left",prop:"filePath"}}),a("el-table-column",{attrs:{label:"文件大小（b）",align:"center",prop:"length"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.dir?void 0:[e._v(" "+e._s(t.row.length)+" ")]}}],null,!0)}),a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-download"},on:{click:function(a){return e.downloadLog(t.row)}}},[e._v("下载")])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1)},n=[],l=a("5530"),o=(a("d81d"),a("b0c0"),a("ddfe")),s=a("104b"),r=a("4a12"),d={name:"fileManager",components:{uploadFile:r["a"]},data:function(){return{loading:!0,ids:[],multiple:!0,showSearch:!0,total:0,list:[],open:!1,dateRange:[],defaultSort:{prop:"operTime",order:"descending"},form:{},queryParams:{pageNum:1,pageSize:10,dir:"upload",mainType:"other",subType:"any",withDir:!0},statusOptions:[{value:!1,label:"文件"},{value:!0,label:"目录"}]}},created:function(){this.getList()},methods:{getList:function(){var e=this;Object(o["b"])(this.queryParams.dir,this.queryParams.mainType,this.queryParams.subType,this.queryParams.withDir).then((function(t){console.log(t),200===t.code?e.list=t.data:e.msgError(t.msg)})),this.loading=!1},fileTypeFormat:function(e,t){return e.dir?"目录":"文件"},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.operId})),this.multiple=!e.length},handleView:function(e){this.open=!0,this.form=e},handleExport:function(){this.download("monitor/operlog/export",Object(l["a"])({},this.queryParams),"operlog_".concat((new Date).getTime(),".xlsx"))},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&config(e.form).then((function(t){200===t.code?(e.msgSuccess("修改成功"),e.open=!1,e.getList()):e.msgError(t.msg)}))}))},cancel:function(){this.open=!1,this.getList()},downloadLog:function(e){var t=e.name+".zip",a=[];a.push(e.filePath),this.$modal.loading("数据下载中..."),s["a"].startDownload(a,"other","any",t,this.downloadFinished,!0)},downloadFinished:function(){this.$modal.closeLoading()},nextFolder:function(e){this.queryParams.dir+="/"+e.name,this.getList()},backFolder:function(){this.queryParams.dir.indexOf("/")<=0||(this.queryParams.dir=this.queryParams.dir.substring(0,this.queryParams.dir.indexOf("/")),this.getList())},onUploadFile:function(e){this.getList()}}},u=d,c=a("2877"),p=Object(c["a"])(u,i,n,!1,null,null,null);t["default"]=p.exports},ddfe:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return l})),a.d(t,"d",(function(){return o})),a.d(t,"c",(function(){return s}));var i=a("70f0");function n(e,t,a,n){var l={commandId:"maintain-req-get-file-list",data:{dir:e,mainType:t,subType:a,withDir:n}};return Object(i["a"])({url:"/maintain/custom",method:"post",data:l})}function l(e,t,a,n){var l={fileList:e,zipAll:t,mainType:a,subType:n};return Object(i["a"])({url:"/file/download",method:"post",data:l,responseType:"blob"})}function o(e,t,a,n){var l={fileList:e,zipAll:t,mainType:a,subType:n},o={commandId:"maintain-req-package-file",data:l};return Object(i["a"])({url:"/maintain/custom",method:"post",data:o})}function s(e){var t={commandId:"maintain-req-operate-file",data:e};return Object(i["a"])({url:"/maintain/custom",method:"post",data:t})}}}]);